{% extends 'layout.html' %}
{% block content %}

    <!--Loading overlay-->
    <script src="https://cdn.jsdelivr.net/npm/gasparesganga-jquery-loading-overlay@2.1.7/dist/loadingoverlay.min.js"
            type="text/javascript"></script>
    <script>
        $(document).ready(function () {
            $("#youtubeButton, #uploadButton").click(function () {
                $.LoadingOverlay("show");
            });
        });
    </script>

    <!--YouTube URL Box-->
    <section class="pt-5">
        <div class="container">
            <form class="row" id="YouTubeForm" method="POST">
                <input type="hidden" name="video" value="youtube">
                <input type="hidden" name="languageSubmit" value="us">
                <div class="col-sm-6">
                    <label for="youtubeUrl" class="visually-hidden">YouTube
                        URL</label>
                    <input type="url" class="form-control"
                           id="youtubeUrl" name="youtubeUrl"
                           placeholder="Enter YouTube URL">
                </div>

                <div class="col-sm-4">
                    <button type="submit" class="btn btn-primary mb-3"
                            id="youtubeButton">Proceed
                        with
                        YouTube Video
                    </button>
                </div>
            </form>
        </div>
    </section>

    <!--Upload form-->
    <section class="pt-3">
        <div class="container">
            <form method="POST" action="" enctype="multipart/form-data">
                <input type="hidden" name="video" value="file">
                <input type="hidden" name="languageSubmit" value="us">
                <div class="row">
                    <div class="col-sm-6">
                        <label for="file" class="form-label">Alternatively
                            upload an MP3 or MP4 file</label>
                    </div>
                </div>

                <div class="row">
                    <div class="col-sm-6">
                        <input class="form-control" type="file" name="file"
                               id="file">
                        <small class="form-text text-muted">
                            Max file size is 500MB.
                        </small>
                    </div>

                    <div class="col-sm-4">
                        <button type="submit" class="btn btn-primary mb-3"
                                id="uploadButton">
                            Proceed
                            with Uploaded File
                        </button>
                    </div>

                </div>
            </form>
        </div>

    </section>

    <!--language select form-->
    <section class="pt-3">
        <div class="container">
            <form method="POST" action="" enctype="multipart/form-data"
                  id="languageForm">
                <div class="row">
                    <div class="col-sm-6">
                        <label class="form-label">Select the video
                            language</label>
                    </div>
                </div>

                <div class="form-check">
                    <input class="form-check-input" type="radio"
                           name="language" id="usEnglish"
                           value="us"
                           checked>
                    <label class="form-check-label" for="usEnglish">
                        US English
                    </label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio"
                           name="language" id="ukEnglish"
                           value="uk"
                    >
                    <label class="form-check-label" for="ukEnglish">
                        UK English
                    </label>
                </div>
            </form>
        </div>

        <!--JQuery script to set the language for the forms-->
        <script>
            $(document).ready(function () {
                $('#languageForm input[type=radio]').click(function () {
                    $("input[name='languageSubmit']").val($('input[name=language]:checked').val());
                });
            });
        </script>

    </section>



    <!--Instructions for how it works-->
    <section class="pt-5">
        <div class="container">
            <h1>How it Works</h1>
            <p class="lead my-3">
                1. Paste the URL for your YouTube video or upload an MP3 / MP4
                file.
                <br>
                2. Enter your query in the chat box.
                <br>
                3. The chatbot will return the timestamp of the part of the
                video
                which best answers your query.
            </p>
        </div>
    </section>

    {% if current_user.is_authenticated %}
        <section class="pt-5">
            <div class="container">
                <h1>Need to Upload Multiple Files?</h1>
                <p class="lead my-3">
                    1. Enter all your YouTube URLs below, separated by a new
                    line.
                    Alternatively upload multiple files below.
                    <br>
                    2. Get an email notification when processing of all the
                    videos has been completed.
                    <br>
                    3. Query your videos from the Saved Videos section!
                </p>
            </div>
        </section>

        <!--YouTube URL Box-->
        <section class="pt-5">
            <div class="container">
                <form class="row" id="multipleYouTubeForm" method="POST"
                      action="{{ url_for('user.upload_multiple_videos') }}">
                    <input type="hidden" name="video" value="youtube">
                    <input type="hidden" name="languageSubmit" value="us">
                    <div class="col-sm-6">
                        <label for="youtubeUrls" class="visually-hidden">YouTube
                            URLs</label>
                        <!-- youtube url is 43 characters. so max length of 430 + 42 means only 10 links allowed -->
                        <textarea class="form-control"
                                  required maxlength="472"
                                  id="youtubeUrls" name="youtubeUrls" rows="3"
                                  placeholder="Enter a YouTube URL on each line (maximum 10 links)"></textarea>
                    </div>

                    <div class="col-sm-4">
                        <button type="submit" class="btn btn-primary mb-3"
                                id="multipleYoutubeButton">Proceed
                            with
                            YouTube Videos
                        </button>
                    </div>
                </form>
            </div>
        </section>

        <!--Upload form-->
        <section class="pt-3">
            <div class="container">
                <form method="POST"
                      action="{{ url_for('user.upload_multiple_videos') }}"
                      enctype="multipart/form-data"
                      id="multipleFileForm">
                    <div class="row">
                        <div class="col-sm-6">
                            <label for="multipleFile" class="form-label">Alternatively
                                upload multiple MP3/MP4 files</label>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-sm-6">
                            <input class="form-control" type="file" multiple
                                   required
                                   name="multipleFile"
                                   id="multipleFile">
                            <small class="form-text text-muted">
                                Maximum combined file size is 500MB.
                            </small>
                        </div>

                        <div class="col-sm-4">
                            <button type="submit" class="btn btn-primary mb-3"
                                    id="multipleUploadButton">
                                Proceed
                                with Uploaded Files
                            </button>
                        </div>

                    </div>
                </form>
            </div>

        </section>


        <script>
            $('#multipleYouTubeForm').submit(function (e) {

                e.preventDefault(); // prevent from submitting form directly
                var multiple_youtube_form = $("#multipleYouTubeForm")
                var data = multiple_youtube_form.serializeArray()

                alert("Job successfully added. You will get a notification when processing is complete.");
                multiple_youtube_form[0].reset(); // reset the form

                $.ajax({
                    url: {{ request.script_root|tojson }} +'/upload_multiple_videos',
                    type: 'POST',
                    data: data // convert all form data to array (key:value)
                })
                    .fail(function (error) {
                        console.log(error); // show the error.
                    });
            })

            $('#multipleFileForm').submit(function (e) {

                e.preventDefault(); // prevent from submitting form directly

                var data = new FormData();
                var videoFiles = document.getElementById("multipleFile")

                for (var i = 0; i < videoFiles.files.length; i++) {
                    data.append('multipleFile[]', videoFiles.files[i], videoFiles.files[i].name);
                }

                data.append('video', 'file')
                data.append('languageSubmit', 'us')

                alert("Job successfully added. You will get a notification when processing is complete.");
                $("#multipleFileForm")[0].reset(); // reset the form

                $.ajax({
                    url: {{ request.script_root|tojson }} +'/upload_multiple_videos',
                    type: 'POST',
                    data: data,
                    enctype: 'multipart/form-data',
                    processData: false,  // tell jQuery not to process the data
                    contentType: false   // tell jQuery not to set contentType
                })
                    .fail(function (error) {
                        console.log(error); // show the error.
                    });
            })
        </script>


    {% endif %}

{% endblock %}